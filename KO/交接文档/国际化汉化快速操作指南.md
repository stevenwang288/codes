# i18n/汉化快速操作指南（面向执行者）

目标：在**不改变任何代码逻辑**的前提下，尽可能把用户可见文案中文化。做法是“批量扫 → 批量替换 → 补语言包”。

## 1. 必备约束

- 不改行为：只动字符串与其调用方式。
- 不翻译：命令/子命令/flag/环境变量名/路径/协议字段/错误码。
- 输出偏好：默认中文；仅在 TUI 且空间足够时可选 `中文（English）` 双语。
- 必须有英文基线：所有新增 key 必须同时进入 `en.json`。

## 2. 最快的扫描命令（建议直接复制）

CLI：

```sh
rg -n "println!\(|eprintln!\(|bail!\(|anyhow!\(|\.context\(\"|\.with_context\(" code-rs/cli/src
```

TUI：

```sh
rg -n "Span::raw\(\"|Line::from\(\"|Paragraph::new\(\"" code-rs/tui/src
```

## 3. 最快的替换规则

### 3.1 静态字符串

把：

```rust
println!("Not logged in");
```

改为：

```rust
println!("{}", code_i18n::tr_plain("cli.login.status.not_logged_in"));
```

### 3.2 含变量

把：

```rust
println!("Added global MCP server '{name}'.");
```

改为：

```rust
println!("{}", code_i18n::tr("cli.mcp.added", &[("name", name.as_str())]));
```

## 4. 语言包更新

- `code-rs/i18n/assets/en.json`：新增 key，值为原英文（不要“顺便润色”，避免和上游 diff 变大）。
- `code-rs/i18n/assets/zh-CN.json`：新增同 key 的中文翻译。

## 5. 推荐拆分顺序（最省心）

1) CLI：登录 / 帮助 / 错误输出（用户最先看到）
2) TUI：onboarding（首次启动必经）
3) TUI：approval/权限提示
4) TUI：bottom pane 按钮/菜单

## 6. 运行与验证（用你约定的入口）

- 在仓库根目录运行 `codes`（Windows PowerShell 用 `codes.cmd`）。
- 能跑 bash 的环境下，最终跑一次 `./build-fast.sh`。
